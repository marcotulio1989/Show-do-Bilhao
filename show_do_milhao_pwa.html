
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Show do Milhão - Importação em Página Separada</title>
  <style>
    body { font-family: Arial, sans-serif; background: #0d1b2a; color: #fff; margin: 0; padding: 0; }
    .container { max-width: 600px; margin: auto; padding: 20px; }
    button, input, select {
      width: 100%; padding: 12px; margin: 6px 0; font-size: 1rem;
      border-radius: 6px; border: none; box-sizing: border-box;
    }
    button { background-color: #f4d35e; color: #000; font-weight: bold; cursor: pointer; }
    .highlight-correct { background-color: green; color: white; }
    .highlight-wrong { background-color: red; color: white; }
    img, video { max-width: 100%; margin-top: 10px; }
    #quiz-section, #form-section, #edit-section, #import-export-section { display: none; }
  </style>

<style>
.explosao {
  position: absolute;
  width: 100px;
  height: 100px;
  background-image: radial-gradient(circle, #ffeb3b 0%, #ff5722 70%, transparent 80%);
  animation: puff 0.6s ease-out forwards;
  pointer-events: none;
  z-index: 9999;
}

@keyframes puff {
  0% {
    transform: scale(0.5);
    opacity: 1;
  }
  100% {
    transform: scale(2.5);
    opacity: 0;
  }
}
</style>


<link rel="manifest" href="manifest.json">
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('service-worker.js').then(() => {
        console.log('Service Worker registrado com sucesso.');
      }).catch(error => {
        console.log('Falha ao registrar Service Worker:', error);
      });
    });
  }
</script>

</head>
<body>

<div id="botao-voltar" style="display:none; position:fixed; top:20px; left:20px; z-index:1000;">
  <button onclick="voltarMenu()" style="background-color:#f4d35e; color:#000; font-weight:bold; border:none; padding:10px 14px; border-radius:8px; cursor:pointer;">
    ← Voltar
  </button>
</div>


<div id="botao-voltar-assunto" style="display:none;" hidden style="display:none; position:fixed; bottom:30px; left:50%; transform:translateX(-50%); z-index:1000; background-color:rgba(255,255,255,0.95); border-radius:8px; padding:10px;">
  <button onclick="voltarEscolhaAssunto()" style="background-color:#f4d35e; color:#000; font-weight:bold; border:none; padding:10px 14px; border-radius:8px; cursor:pointer;">
    ← Escolher outro assunto
  </button>
</div>

<div class="container">
<div id="assunto-section" style="display:block;">
  <h2>Escolha um Assunto</h2>
  <button onclick="selecionarAssunto('História')">História</button>
  <button onclick="selecionarAssunto('Geografia')">Geografia</button>
  <button onclick="selecionarAssunto('Física')">Física</button>
  <button onclick="selecionarAssunto('Matemática')">Matemática</button>
  <button onclick="selecionarAssunto('Biologia')">Biologia</button>
  <button onclick="selecionarAssunto('Português')">Português</button>
  <button onclick="selecionarAssunto('Espanhol')">Espanhol</button>
  <button onclick="selecionarAssunto('Química')">Química</button>
</div>

  <h1>Show do Milhão</h1>
  
<div id="tempo-config" style="display:none;" style="margin-top:10px;">
  <label for="tempo-pergunta">⏱️ Tempo por pergunta (segundos):</label>
  <input id="tempo-pergunta" type="number" min="10" max="999" value="120" onchange="atualizarTempo()" style="width:100%;padding:10px;border-radius:6px;margin-top:5px;">
</div>

<div id="menu" style="display:none;">
    <button onclick="startQuiz()">Começar Quiz Aleatório</button>
    <button onclick="showForm()">Adicionar Pergunta</button>
    <button onclick="showEditPanel()">Editar/Excluir Perguntas</button>
    <button onclick="mostrarImportExport()">Importar/Exportar Perguntas</button>

<button onclick="voltarEscolhaAssunto()" style="background-color: #f4d35e; color: black; font-weight: bold; padding: 15px; border: none; border-radius: 10px; margin-top: 10px; width: 100%;">Escolher Outro Assunto</button>

  </div>

  <div id="quiz-section">
    <h2 id="pergunta"></h2>
    <div id="media-container"></div>
    <div id="alternativas"></div>
    <p id="resposta"></p>
  </div>

  <div id="form-section">
    <select id="assunto-pergunta"><option value="História">História</option><option value="Geografia">Geografia</option><option value="Física">Física</option><option value="Matemática">Matemática</option><option value="Biologia">Biologia</option><option value="Português">Português</option><option value="Espanhol">Espanhol</option><option value="Química">Química</option></select>
<input id="nova-pergunta" placeholder="Pergunta" />
    <input id="alt1" placeholder="Alternativa A" />
    <input id="alt2" placeholder="Alternativa B" />
    <input id="alt3" placeholder="Alternativa C" />
    <input id="alt4" placeholder="Alternativa D" />
    <input id="alt5" placeholder="Alternativa E" />
    <select id="resposta-correta">
      <option value="0">A</option><option value="1">B</option>
      <option value="2">C</option><option value="3">D</option>
      <option value="4">E</option>
    </select>
    <input type="file" id="media-upload" accept="image/*,video/*" onchange="previewMidia()" />
    <div id="media-preview"></div>
    <button onclick="salvarPergunta()">Salvar</button>
    <button onclick="voltarMenu()">Voltar</button>
  </div>

  <div id="edit-section">
    <div id="painel-edicao"></div>
    <button onclick="voltarMenu()">Voltar</button>
  </div>

  <div id="import-export-section">
    <h2>Importar/Exportar Perguntas</h2>
    <button onclick="exportarBanco()">Exportar Perguntas</button>
    <label for="importar-arquivo" style="background-color:#f4d35e; color:#000; font-weight:bold; cursor:pointer; padding:12px; display:block; text-align:center; border-radius:6px; margin:6px 0;">Importar Perguntas</label>
<input type="file" id="importar-arquivo" accept=".json" onchange="importarBanco()" style="display:none;" />
    <button onclick="voltarMenu()">Voltar</button>
  </div>
</div>

<audio id="audio-correto" src="https://www.soundjay.com/button/sounds/button-4.mp3"></audio>
<audio id="audio-errado" src="https://www.soundjay.com/button/sounds/button-10.mp3"></audio>

<script>
  
let tempoPorPergunta = localStorage.getItem('tempoPorPergunta') ? parseInt(localStorage.getItem('tempoPorPergunta')) : 120;

function atualizarTempo() {
  const novoTempo = parseInt(document.getElementById('tempo-pergunta').value);
  if (!isNaN(novoTempo)) {
    tempoPorPergunta = novoTempo;
    localStorage.setItem('tempoPorPergunta', tempoPorPergunta);
  }
}

let bancoPerguntas = JSON.parse(localStorage.getItem('bancoPerguntas')) || [];
  let perguntasAleatorias = [];
  let perguntaAtual = 0;
  let mediaBase64 = "";
  let editandoIndice = null;

  
let assuntoSelecionado = "";

function selecionarAssunto(assunto) {
  assuntoSelecionado = assunto;
  document.getElementById('assunto-section').style.display = 'none';
  document.getElementById('menu').style.display = 'block';
  document.getElementById('botao-voltar-assunto').style.display = 'block';
  document.getElementById('botao-voltar').style.display = 'none';
  document.getElementById('botao-voltar-assunto').style.display = 'none';
  document.getElementById('botao-voltar-assunto').style.display = 'none';
  document.getElementById('tempo-config').style.display = 'block';
}


function startQuiz() {
  perguntasAleatorias = bancoPerguntas
    .filter(p => p.assunto === assuntoSelecionado)
    .sort(() => Math.random() - 0.5);
  perguntaAtual = 0;
  esconderTodasAsPaginas();
  document.getElementById('quiz-section').style.display = 'block';
  document.getElementById('botao-voltar').style.display = 'none';
  document.getElementById('botao-voltar-assunto').style.display = 'none';
  document.getElementById('botao-voltar-assunto').style.display = 'none';
  mostrarPergunta();

}


function startQuiz() {
  perguntasAleatorias = bancoPerguntas
    .filter(p => p.assunto === assuntoSelecionado)
    .sort(() => Math.random() - 0.5);
  perguntaAtual = 0;
  esconderTodasAsPaginas();
  document.getElementById('quiz-section').style.display = 'block';
  document.getElementById('botao-voltar').style.display = 'none';
  document.getElementById('botao-voltar-assunto').style.display = 'none';
  document.getElementById('botao-voltar-assunto').style.display = 'none';
  mostrarPergunta();

  }

  function mostrarPergunta() {
    const p = perguntasAleatorias[perguntaAtual];
    document.getElementById('pergunta').innerText = p.pergunta;
    document.getElementById('alternativas').innerHTML = '';
    document.getElementById('media-container').innerHTML = '';
    if (p.midia) {
      const m = p.midia.startsWith('data:video') ? document.createElement('video') : document.createElement('img');
      m.src = p.midia;
      if (m.tagName === 'VIDEO') m.controls = true;
      document.getElementById('media-container').appendChild(m);
    }
    p.alternativas.forEach((alt, idx) => {
      const btn = document.createElement('button');
      btn.textContent = alt;
      btn.onclick = () => verificarResposta(idx, btn);
      document.getElementById('alternativas').appendChild(btn);
    });
    document.getElementById('resposta').textContent = '';
  }

  function verificarResposta(idx, botao) {
    const correta = perguntasAleatorias[perguntaAtual].resposta_correta;
    const audio = document.getElementById(idx === correta ? 'audio-correto' : 'audio-errado');
    audio.play();
    botao.classList.add(idx === correta ? 'highlight-correct' : 'highlight-wrong');
    document.getElementById('resposta').textContent =
      idx === correta ? '✔️ Resposta correta!' : '❌ Resposta errada!';
    setTimeout(() => {
      perguntaAtual = (perguntaAtual + 1) % perguntasAleatorias.length;
      mostrarPergunta();
    }, tempoPorPergunta * 1000);
  }

  function showForm(i = null) {
    esconderTodasAsPaginas();
    document.getElementById('form-section').style.display = 'block';
    if (i !== null) {
      const p = bancoPerguntas[i];
      ['nova-pergunta','alt1','alt2','alt3','alt4','alt5'].forEach((id, j) =>
        document.getElementById(id).value = j === 0 ? p.pergunta : p.alternativas[j-1]);
      document.getElementById('resposta-correta').value = p.resposta_correta;
      mediaBase64 = p.midia || "";
      editandoIndice = i;
    } else {
      editandoIndice = null;
      document.querySelectorAll('#form-section input').forEach(el => el.value = '');
      document.getElementById('media-preview').innerHTML = '';
      mediaBase64 = "";
    }
  }

  
function voltarEscolhaAssunto() {
  assuntoSelecionado = "";
  esconderTodasAsPaginas();
  document.getElementById('assunto-section').style.display = 'block';
  document.getElementById('botao-voltar').style.display = 'none';
  document.getElementById('botao-voltar-assunto').style.display = 'none';
  document.getElementById('botao-voltar-assunto').style.display = 'none';
  document.getElementById('botao-voltar-assunto').style.display = 'none';
}


function voltarMenu() {
    esconderTodasAsPaginas();
    document.getElementById('menu').style.display = 'block';
  document.getElementById('botao-voltar-assunto').style.display = 'block';
  document.getElementById('botao-voltar').style.display = 'none';
  document.getElementById('botao-voltar-assunto').style.display = 'none';
  document.getElementById('botao-voltar-assunto').style.display = 'none';
  document.getElementById('tempo-config').style.display = 'block';
    editandoIndice = null;
    mediaBase64 = "";
  }

  function esconderTodasAsPaginas() {
  document.getElementById('botao-voltar').style.display = 'block';
  document.getElementById('tempo-config').style.display = 'none';
    ['menu','form-section','quiz-section','edit-section','import-export-section'].forEach(id =>
      document.getElementById(id).style.display = 'none');
  }

  function previewMidia() {
    const file = document.getElementById('media-upload').files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = e => {
      mediaBase64 = e.target.result;
      const container = document.getElementById('media-preview');
      container.innerHTML = '';
      const tag = file.type.startsWith('video') ? 'video' : 'img';
      const el = document.createElement(tag);
      el.src = mediaBase64;
      if (tag === 'video') el.controls = true;
      container.appendChild(el);
    };
    reader.readAsDataURL(file);
  }

  function salvarPergunta() {
    const pergunta = document.getElementById('nova-pergunta').value;
    const alternativas = [1,2,3,4,5].map(i => document.getElementById('alt'+i).value);
    const resposta = parseInt(document.getElementById('resposta-correta').value);
    if (pergunta && alternativas.every(a => a)) {
      const assunto = document.getElementById('assunto-pergunta').value;
      const nova = { pergunta, alternativas, resposta_correta: resposta, midia: mediaBase64, assunto };
      if (editandoIndice !== null) bancoPerguntas[editandoIndice] = nova;
      else bancoPerguntas.push(nova);
      localStorage.setItem('bancoPerguntas', JSON.stringify(bancoPerguntas));
      alert('Pergunta salva!');
      voltarMenu();
    } else alert('Preencha todos os campos!');
  }

  function showEditPanel() {
    esconderTodasAsPaginas();
    document.getElementById('edit-section').style.display = 'block';
    const painel = document.getElementById('painel-edicao');
    painel.innerHTML = '';
    bancoPerguntas.forEach((p, i) => {
      const div = document.createElement('div');
      div.innerHTML = `<p><b>${i+1}.</b> ${p.pergunta}</p>
        <button onclick="showForm(${i})">Editar</button>
        <button onclick="excluirPergunta(${i})">Excluir</button>`;
      painel.appendChild(div);
    });
  }

  function excluirPergunta(i) {
    if (confirm('Excluir essa pergunta?')) {
      bancoPerguntas.splice(i,1);
      localStorage.setItem('bancoPerguntas', JSON.stringify(bancoPerguntas));
      showEditPanel();
    }
  }

  function mostrarImportExport() {
    esconderTodasAsPaginas();
    document.getElementById('import-export-section').style.display = 'block';
  }

  function exportarBanco() {
    const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(bancoPerguntas));
    const dlAnchor = document.createElement('a');
    dlAnchor.setAttribute("href", dataStr);
    dlAnchor.setAttribute("download", "banco_perguntas.json");
    dlAnchor.click();
  }

  function importarBanco() {
    const file = document.getElementById('importar-arquivo').files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = e => {
      try {
        const novoBanco = JSON.parse(e.target.result);
        if (Array.isArray(novoBanco)) {
          bancoPerguntas = novoBanco;
          localStorage.setItem('bancoPerguntas', JSON.stringify(bancoPerguntas));
          alert('Importado com sucesso!');
        } else alert('Arquivo inválido.');
      } catch {
        alert('Erro ao importar arquivo.');
      }
    };
    reader.readAsText(file);
  }
</script>
</body>
</html>
